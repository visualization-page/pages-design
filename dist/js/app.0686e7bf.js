(function(e){function t(t){for(var r,a,o=t[0],c=t[1],l=t[2],u=0,d=[];u<o.length;u++)a=o[u],s[a]&&d.push(s[a][0]),s[a]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);f&&f(t);while(d.length)d.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,a=1;a<n.length;a++){var o=n[a];0!==s[o]&&(r=!1)}r&&(i.splice(t--,1),e=c(c.s=n[0]))}return e}var r={},a={app:0},s={app:0},i=[];function o(e){return c.p+"js/"+({}[e]||e)+"."+{"chunk-7b53fefb":"f67254db"}[e]+".js"}function c(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.e=function(e){var t=[],n={"chunk-7b53fefb":1};a[e]?t.push(a[e]):0!==a[e]&&n[e]&&t.push(a[e]=new Promise(function(t,n){for(var r="css/"+({}[e]||e)+"."+{"chunk-7b53fefb":"6f954fd6"}[e]+".css",s=c.p+r,i=document.getElementsByTagName("link"),o=0;o<i.length;o++){var l=i[o],u=l.getAttribute("data-href")||l.getAttribute("href");if("stylesheet"===l.rel&&(u===r||u===s))return t()}var d=document.getElementsByTagName("style");for(o=0;o<d.length;o++){l=d[o],u=l.getAttribute("data-href");if(u===r||u===s)return t()}var f=document.createElement("link");f.rel="stylesheet",f.type="text/css",f.onload=t,f.onerror=function(t){var r=t&&t.target&&t.target.src||s,i=new Error("Loading CSS chunk "+e+" failed.\n("+r+")");i.request=r,delete a[e],f.parentNode.removeChild(f),n(i)},f.href=s;var p=document.getElementsByTagName("head")[0];p.appendChild(f)}).then(function(){a[e]=0}));var r=s[e];if(0!==r)if(r)t.push(r[2]);else{var i=new Promise(function(t,n){r=s[e]=[t,n]});t.push(r[2]=i);var l,u=document.createElement("script");u.charset="utf-8",u.timeout=120,c.nc&&u.setAttribute("nonce",c.nc),u.src=o(e),l=function(t){u.onerror=u.onload=null,clearTimeout(d);var n=s[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src,i=new Error("Loading chunk "+e+" failed.\n("+r+": "+a+")");i.type=r,i.request=a,n[1](i)}s[e]=void 0}};var d=setTimeout(function(){l({type:"timeout",target:u})},12e4);u.onerror=u.onload=l,document.head.appendChild(u)}return Promise.all(t)},c.m=e,c.c=r,c.d=function(e,t,n){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)c.d(n,r,function(t){return e[t]}.bind(null,r));return n},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="",c.oe=function(e){throw console.error(e),e};var l=window["webpackJsonp"]=window["webpackJsonp"]||[],u=l.push.bind(l);l.push=t,l=l.slice();for(var d=0;d<l.length;d++)t(l[d]);var f=u;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"00c2":function(e,t,n){"use strict";n("7f7f");var r=n("7618"),a=n("267e");t["a"]={sockets:{connect:function(){this.$socket.emit("chat",[a["a"].INIT])},disconnect:function(){console.log("disconnect unsubscribe operatorLog")},operatorLog:function(e){if(this.$parent.messageArr.push(e),this.$parent.messageArr.length>500&&this.$parent.messageArr.splice(500,this.$parent.messageArr.length),"object"===Object(r["a"])(e)&&e.result)switch(e.name){case a["a"].PREPARE_TEMPLATE:this.afterMakeTemplate(e.result);break;case a["a"].PROJECT_INFO:this.afterProjectInfo(e.result);break;case a["a"].PUT_COMPONENT:this.afterPutComponent(e.result);break;case a["a"].DEL_COMPONENT:this.afterDelComponents(e.result);break;case a["a"].UPDATE_COMPONENT:this.afterUpdateSchema(e.result);break;case a["a"].SAVE_PAGE_CONFIG:this.afterSavePageConfig(e.result);break;case a["a"].UPDATE_COMPONENT_SORT:this.refreshIframe();break;case a["a"].PUBLISH:this.afterPublish();break;case a["a"].SET_STATUS:this.afterSetProjectStatus(e.result);break;case a["a"].CHECK_UPDATE:this.afterCheckProjectTemplateAndComponentVersion();break}}},methods:{socket:function(e,t){this.$socket.emit("chat",[e,t])},setProjectStatus:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";this.socket(a["a"].SET_STATUS,{dirName:this.dirName,status:e})},afterSetProjectStatus:function(e){console.log(e)}}}},"267e":function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r={INIT:"init",PREPARE_TEMPLATE:"prepareTemplate",PUT_COMPONENT:"putComponent",PROJECT_INFO:"projectInfo",UPDATE_COMPONENT:"updateComponent",DEL_COMPONENT:"delComponent",PUBLISH:"publish",LOOK_PROCESS:"lookProcess",SAVE_PAGE_CONFIG:"savePageConfig",UPDATE_COMPONENT_SORT:"updateComponentSort",SET_STATUS:"setProjectStatus",CHECK_UPDATE:"checkTemplateComponentUpdate"}},"56d7":function(e,t,n){"use strict";n.r(t);n("cadf"),n("551c"),n("097d");var r=n("2b0e"),a=n("74f1"),s=n.n(a),i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[e._m(0),n("div",{staticClass:"wrapper"},[n("router-view")],1),n("div",{staticClass:"message",class:{message__show:e.showMessage}},[n("div",{staticClass:"message__wrap"},[e._l(e.messageArr.filter(function(e){return e}),function(t,r){return n("p",{key:t+r,domProps:{innerHTML:e._s("string"===typeof t?t.replace(/(\n)+/g,"<br>"):t)}})}),n("div",{ref:"end",staticClass:"message__end"})],2)])])},o=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"nav"},[n("h1",[e._v("PAGE "),n("span",[e._v("项目可视化组件搭建工具")])])])}],c=n("f499"),l=n.n(c),u=n("7618"),d={name:"app",data:function(){return{messageArr:[],showMessage:!1,loadingText:""}},watch:{messageArr:function(e){this.loadingText=e.length?e[e.length-1]:"","object"===Object(u["a"])(this.loadingText)&&(this.loadingText=l()(this.loadingText)),this.loadingText.length>200&&(this.loadingText=this.loadingText.substr(0,200)),this.$refs.end&&this.$refs.end.scrollIntoView(!1)}},methods:{clearMessage:function(){this.messageArr=[]},toggleMessage:function(){this.showMessage=!this.showMessage}}},f=d,p=(n("7faf"),n("2877")),h=Object(p["a"])(f,i,o,!1,null,null,null);h.options.__file="App.vue";var m=h.exports,g=n("8c4f"),b=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],staticClass:"home",attrs:{"element-loading-text":e.$parent.loadingText,"element-loading-spinner":"el-icon-loading"}},[e._m(0),n("div",{staticClass:"home__content"},[n("el-button",{attrs:{type:"primary",size:"medium"},on:{click:e.newProject}},[e._v("新建项目")]),n("div",{staticClass:"home__content--list"},[n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.recordsList,stripe:""}},[n("el-table-column",{attrs:{prop:"id",width:"60px",label:"编号"}}),n("el-table-column",{attrs:{prop:"dir_name",label:"项目名称"}}),n("el-table-column",{attrs:{prop:"url",width:"400px",label:"项目地址"}}),n("el-table-column",{attrs:{prop:"updated_at",label:"更新时间"}}),n("el-table-column",{attrs:{prop:"editStatus",width:"80px",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[r.isEdit?n("span",{staticStyle:{color:"#E6A23C"}},[e._v("编辑中")]):1===r.status?n("span",{staticStyle:{color:"#67C23A"}},[e._v("已构建")]):n("span",{staticStyle:{color:"#999"}},[e._v("未构建")])]}}])}),n("el-table-column",{attrs:{align:"right",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.isEdit?n("span",[e._v("-")]):[n("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(n){e.editRecord(t.row)}}},[e._v("编辑")]),n("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(n){e.delRecord(t.row)}}},[e._v("删除")])]]}}])})],1)],1)],1),n("el-dialog",{attrs:{title:"编辑页面",visible:e.dialogVisible,width:"540px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[e.currentProject?n("div",{staticClass:"template__list"},e._l(e.cacheProjectPages[e.currentProject.id],function(t){return n("div",{key:t.id,staticClass:"template__item"},[n("p",{staticClass:"template__item--title"},[e._v(e._s(t.name||t.id))]),n("div",{staticClass:"template__item--btn"},[n("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:function(n){e.toCreate(e.currentProject,t.id)}}},[e._v("\n            编辑\n          ")]),t.id?n("el-button",{attrs:{type:"danger",plain:"",size:"mini"},on:{click:function(n){e.delPage(e.currentProject.dir_name,t.id)}}},[e._v("\n            删除\n          ")]):e._e()],1)])}),0):e._e(),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){e.addPage(e.currentProject)}}},[e._v("\n        新建页面\n      ")])],1)]),n("el-dialog",{attrs:{title:"输入项目名称",visible:e.showInputName,width:"450px"},on:{"update:visible":function(t){e.showInputName=t}}},[n("el-form",{ref:"ruleForm",attrs:{model:e.form,rules:e.rules}},[n("el-form-item",{attrs:{prop:"name"}},[n("el-input",{attrs:{size:"small",placeholder:"字母、数字、下划线"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.createProject}},[e._v("\n        确 定\n      ")])],1)],1)],1)},v=[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"title"},[n("span",[e._v("项目信息")])])}],_=(n("20d6"),n("7f7f"),n("a481"),n("cebc")),P=(n("96cf"),n("3b8d")),T=n("fc19"),w=n.n(T),y=n("267e"),E=n("00c2"),k={name:"home",components:{},mixins:[E["a"]],data:function(){var e=function(e,t,n){""===t?n(new Error("请输入")):/^[a-zA-Z0-9-]+$/.test(t)?n():n(new Error("只能为字母、数字、下划线"))};return{templateList:[],recordsList:[],dialogVisible:!1,showInputName:!1,fullscreenLoading:!1,form:{name:""},rules:{name:[{validator:e,trigger:"blur"}]},selectedTemplate:null,cacheProjectPages:{},currentProject:null}},created:function(){var e=Object(P["a"])(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.$parent.messageArr=[],e.next=3,this.$http.get("getRecords");case 3:return t=e.sent,this.recordsList=t.data.map(function(e){return Object(_["a"])({},e,{isEdit:"edit"===e.editStatus,url:e.status?e.url.replace("/dist/","/release/"):e.url,updated_at:w()(e.updated_at).format("YYYY/MM/DD HH:mm")})}),e.next=7,this.$http.get("getTemplate");case 7:n=e.sent,this.templateList=n.data;case 9:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),methods:{editRecord:function(){var e=Object(P["a"])(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.cacheProjectPages[t.id]){e.next=8;break}return this.loading("获取页面"),e.next=4,this.$http.get("getProjectPages",{dirName:t.dir_name});case 4:n=e.sent,this.loading(!1),this.cacheProjectPages[t.id]=n.data,this.cacheProjectPages[t.id].unshift({id:0,name:"首页"});case 8:this.dialogVisible=!0,this.currentProject=t;case 10:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),toCreate:function(e,t){localStorage.setItem("page_".concat(t),l()(this.cacheProjectPages[e.id])),this.$router.push("/project/edit/".concat(e.id,"/").concat(e.dir_name).concat(t?"?pageId=".concat(t):""))},newProject:function(){this.selectTemplate(this.templateList[0])},selectTemplate:function(e){this.selectedTemplate=e,this.showInputName=!0},createProject:function(){var e=this;this.$refs.ruleForm.validate(function(t){if(!t)return!1;e.makeTemplate(e.selectedTemplate.id,e.form.name)})},makeTemplate:function(e,t){this.fullscreenLoading=!0,this.$parent.clearMessage(),this.socket(y["a"].PREPARE_TEMPLATE,{templateId:e,dirName:t})},afterMakeTemplate:function(e){var t=this,n=e.recordId,r=e.dirName,a=e.exist;if(a)return this.$message.error("项目名称已存在"),void(this.fullscreenLoading=!1);this.$message.success("创建项目成功"),this.showInputName=!1,setTimeout(function(){t.fullscreenLoading=!1,t.$router.push("/project/edit/".concat(n,"/").concat(r))},2e3)},delRecord:function(){var e=Object(P["a"])(regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$confirm("确定要删除吗？",{type:"warning"});case 2:if(n=e.sent,"confirm"===n){e.next=5;break}return e.abrupt("return");case 5:return this.loading("移除项目文件、删除redis等..."),e.next=8,this.$http.post("delRecord",{id:t.id,dirName:t.dir_name});case 8:r=this.recordsList.findIndex(function(e){return e.id===t.id}),this.recordsList.splice(r,1),this.loading(!1);case 11:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),addPage:function(){var e=Object(P["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.loading("添加页面"),e.next=3,this.$http.post("addProjectPages",{dirName:t.dir_name});case 3:this.loading(!1),this.$message.success("添加成功");case 5:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),delPage:function(){var e=Object(P["a"])(regeneratorRuntime.mark(function e(t,n){var r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$confirm("确定要删除吗？",{type:"warning"});case 2:if(r=e.sent,"confirm"===r){e.next=5;break}return e.abrupt("return");case 5:return this.loading("删除页面"),e.next=8,this.$http.post("delProjectPages",{dirName:t,pageId:n});case 8:this.loading(!1),this.$message.success("删除成功");case 10:case"end":return e.stop()}},e,this)}));function t(t,n){return e.apply(this,arguments)}return t}(),loading:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0;t&&this.$parent.messageArr.push(t),this.fullscreenLoading=e}}},j=k,C=(n("c219"),Object(p["a"])(j,b,v,!1,null,null,null));C.options.__file="Home.vue";var x=C.exports;r["default"].use(g["a"]);var O=new g["a"]({routes:[{path:"/",name:"home",component:x},{path:"/project",name:"project",component:function(){return n.e("chunk-7b53fefb").then(n.bind(null,"d879"))},children:[{path:":type/:id/:dirName",component:function(){return n.e("chunk-7b53fefb").then(n.bind(null,"d879"))}}]}]}),S=n("2f62");r["default"].use(S["a"]);var N=new S["a"].Store({state:{},mutations:{},actions:{}}),$=n("8b25"),A=n.n($),R=(n("fc0d"),n("d9c6"),n("73eb")),L=n.n(R),M=(n("53fa"),n("cfce")),I=n.n(M),U=(n("b6ba"),n("c585")),D=n.n(U),z=(n("1f41"),n("bfe0")),H=n.n(z),V=(n("f81e"),n("2f43")),F=n.n(V),B=(n("41c3"),n("874a")),G=n.n(B),J=(n("7765"),n("d6c3")),Y=n.n(J),K=(n("70dc"),n("201c")),q=n.n(K),Z=(n("f8fa"),n("b539")),Q=n.n(Z),W=(n("3cbd"),n("aea7")),X=n.n(W),ee=(n("9f9e"),n("8603")),te=n.n(ee),ne=(n("6f32"),n("1648")),re=n.n(ne),ae=(n("9c11"),n("e453")),se=n.n(ae),ie=(n("6f02"),n("ab07")),oe=n.n(ie),ce=(n("7861"),n("20c5")),le=n.n(ce),ue=(n("6ed1"),n("8755")),de=n.n(ue),fe=(n("165b"),n("e636")),pe=n.n(fe),he=(n("bf1b"),n("e3f6")),me=n.n(he),ge=(n("7354"),n("4305")),be=n.n(ge);r["default"].use(be.a),r["default"].use(me.a),r["default"].use(pe.a),r["default"].use(de.a),r["default"].use(le.a),r["default"].use(oe.a),r["default"].use(se.a),r["default"].use(re.a),r["default"].use(te.a),r["default"].use(X.a),r["default"].use(Q.a),r["default"].use(q.a),r["default"].use(Y.a),r["default"].use(G.a),r["default"].use(F.a),r["default"].use(H.a),r["default"].use(D.a.directive),r["default"].prototype.$loading=D.a.service,r["default"].prototype.$msgbox=I.a,r["default"].prototype.$alert=I.a.alert,r["default"].prototype.$confirm=I.a.confirm,r["default"].prototype.$message=L.a,r["default"].use(new s.a({connection:"http://127.0.0.1:7001/"})),r["default"].config.productionTip=!1,r["default"].prototype.$http=new A.a({baseURL:"http://127.0.0.1:7001",uri:{getTemplate:"/templates",getComponents:"/components",getRecords:"/records",delRecord:"/delRecord",getProjectPages:"/records/pages",addProjectPages:"/records/pages/add",delProjectPages:"/records/pages/del"},timeout:6e5}),new r["default"]({router:O,store:N,render:function(e){return e(m)}}).$mount("#app")},"7faf":function(e,t,n){"use strict";var r=n("8fba"),a=n.n(r);a.a},"8fba":function(e,t,n){},c219:function(e,t,n){"use strict";var r=n("e9bb"),a=n.n(r);a.a},e9bb:function(e,t,n){}});
//# sourceMappingURL=app.0686e7bf.js.map